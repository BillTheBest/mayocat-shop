<!--

    Copyright (c) 2012, Mayocat <hello@mayocat.org>

    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.

-->
<div class="block" ng-repeat="group in addons">
    <h3>{{group.name}}</h3>

    <p ng-if="group.text && group.text != ''">
        {{group.text}}
    </p>

    <!-- Sequence addons -->
    <div ng-if="group.sequence">

        <!-- Add element button when positioned at the bottom -->
        <div ng-if="group.properties['sequence.newElementPosition'] == 'first'">
            <div class="btn btn-add" ng-click="addSequenceAddonItem(group)">+</div>

            <span ng-if="group.properties['sequence.addElementText']">{{group.properties['sequence.addElementText']}}</span>
            <span ng-if="!group.properties['sequence.addElementText']">{{'entity.addons.sequenceAddElementText' | translate}}</span>
        </div>

        <ul ng-repeat="item in entity.addons[group.key].value">
            <li>
                <div class="btn btn-add pull-right" ng-click="removeSequenceAddonItem(group, $index)">&ndash;</div>
                <div class="clearfix"></div>
            </li>

            <li ng-repeat="addon in group.fields">
                {{addon.definition.name}}

                <addon definition="addon.definition"
                       type="entity.addons[group.key].model[addon.key]"
                       object="item"
                       localized-object="localized.addons[group.key].value[$parent.$index]"
                       key="addon.key"
                       no-drop-zone="true"></addon>
            </li>
        </ul>

        <!-- Add element button when positioned at the bottom -->
        <div ng-if="!group.properties['sequence.newElementPosition'] || group.properties['sequence.newElementPosition'] == 'last'">
            <div class="btn btn-add" ng-click="addSequenceAddonItem(group)">+</div>

            <span ng-if="group.properties['sequence.addElementText']">{{group.properties['sequence.addElementText']}}</span>
            <span ng-if="!group.properties['sequence.addElementText']">{{'entity.addons.sequenceAddElementText' | translate}}</span>
        </div>
    </div>

    <!-- Non sequence addons -->
    <ul ng-if="!group.sequence">

        <li ng-repeat="addon in group.fields">
            {{addon.definition.name}}

            <addon definition="addon.definition"
                   type="entity.addons[group.key].model[addon.key]"
                   object="entity.addons[group.key].value"
                   localized-object="localized.addons[group.key].value"
                   key="addon.key"
                   no-drop-zone="false"></addon>
        </li>
    </ul>
</div>

